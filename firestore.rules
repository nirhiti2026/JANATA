rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users collection - allow read for authenticated users, write only their own
    match /users/{userId} {
      allow read: if request.auth != null;
      allow write: if request.auth.uid == userId;
    }

    // Problems collection - allow create for authenticated users, read/update based on rules
    match /problems/{problemId} {
      allow create: if request.auth != null;
      allow read: if request.auth != null;
      allow update: if request.auth != null;
      allow delete: if request.auth.uid == resource.data.reportedBy;
    }

    // Solutions - allow read for all authenticated users
    match /problems/{problemId}/solutions/{solutionId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }

    // Election Results - allow read for all authenticated users
    match /election_results/{resultId} {
      allow read: if request.auth != null;
      allow write: if false; // Only server can write
    }

    // Politician Complaints - authenticated users can submit complaints
    match /politician_complaints/{complaintId} {
      allow create: if request.auth != null;
      allow read: if request.auth != null;
      allow update: if request.auth.uid == resource.data.citizenId || request.auth.uid == resource.data.politicianId;
      allow delete: if request.auth.uid == resource.data.citizenId;
    }

    // Donations - authenticated users can create and read donations
    match /donations/{donationId} {
      allow create: if request.auth != null;
      allow read: if request.auth != null;
      allow update: if request.auth.uid == resource.data.donorId;
      allow delete: if request.auth.uid == resource.data.donorId;
    }

    // Charity Organizations - allow read for all authenticated users
    match /charity_organizations/{orgId} {
      allow read: if request.auth != null;
      allow write: if false; // Only server can write
    }

    // Deny all other access
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
